"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[786],{7094:(s,a,n)=>{n.r(a),n.d(a,{data:()=>p});const p={key:"v-25205979",path:"/v1/quick-start/authentication.html",title:"认证和授权",lang:"en-US",frontmatter:{title:"认证和授权"},excerpt:"",headers:[{level:2,title:"认证和授权",slug:"认证和授权",children:[{level:3,title:"认证&授权流程",slug:"认证-授权流程",children:[]},{level:3,title:"认证 Authentication",slug:"认证-authentication",children:[]},{level:3,title:"授权 Authorization",slug:"授权-authorization",children:[]}]}],filePathRelative:"v1/quick-start/authentication.md",git:{updatedTime:1637484686e3,contributors:[{name:"Tinywan",email:"756684177@qq.com",commits:1}]}}},9792:(s,a,n)=>{n.r(a),n.d(a,{default:()=>T});var p=n(6252);const o=(0,p.uE)('<h2 id="认证和授权" tabindex="-1"><a class="header-anchor" href="#认证和授权" aria-hidden="true">#</a> 认证和授权</h2><hr><p>:::note 小提示 authentication&amp;authorization <br> :::</p><h3 id="认证-授权流程" tabindex="-1"><a class="header-anchor" href="#认证-授权流程" aria-hidden="true">#</a> 认证&amp;授权流程</h3><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>  <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n  <span class="token operator">|</span> <span class="token class-name">RESOURCE</span> <span class="token constant">EXISTS</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token keyword">private</span> it is often checked <span class="token constant">AFTER</span> auth check<span class="token punctuation">)</span>\n  <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n    <span class="token operator">|</span>       <span class="token operator">|</span>\n <span class="token class-name">NO</span> <span class="token operator">|</span>       <span class="token class-name">v</span> <span class="token constant">YES</span>\n    v      <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n   <span class="token number">404</span>     <span class="token operator">|</span> <span class="token class-name">IS</span> <span class="token constant">LOGGED</span><span class="token operator">-</span><span class="token constant">IN</span> <span class="token operator">?</span> <span class="token punctuation">(</span>authenticated<span class="token punctuation">,</span> aka has session <span class="token keyword">or</span> <span class="token constant">JWT</span> cookie<span class="token punctuation">)</span>\n   <span class="token keyword">or</span>      <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n   <span class="token number">401</span>        <span class="token operator">|</span>              <span class="token operator">|</span>\n   <span class="token number">403</span>     <span class="token class-name">NO</span> <span class="token operator">|</span>              <span class="token operator">|</span> <span class="token class-name">YES</span>\n   <span class="token number">3</span>xx        v              v\n              <span class="token number">401</span>            <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n       <span class="token punctuation">(</span><span class="token number">404</span> no reveal<span class="token punctuation">)</span>       <span class="token operator">|</span> <span class="token class-name">CAN</span> <span class="token constant">ACCESS</span> <span class="token constant">RESOURCE</span> <span class="token operator">?</span> <span class="token punctuation">(</span>permission<span class="token punctuation">,</span> authorized<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>\n              <span class="token keyword">or</span>             <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\n             <span class="token class-name">redirect</span>          <span class="token operator">|</span>            <span class="token operator">|</span>\n             <span class="token class-name">to</span> login       <span class="token class-name">NO</span> <span class="token operator">|</span>            <span class="token operator">|</span> <span class="token class-name">YES</span>\n                               <span class="token operator">|</span>            <span class="token operator">|</span>\n                               <span class="token class-name">v</span>            v\n                               <span class="token number">403</span>          <span class="token constant">OK</span> <span class="token number">200</span><span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> <span class="token operator">...</span>\n                      <span class="token punctuation">(</span><span class="token keyword">or</span> <span class="token number">404</span><span class="token punctuation">:</span> no reveal<span class="token punctuation">)</span>\n                      <span class="token punctuation">(</span><span class="token keyword">or</span> <span class="token number">404</span><span class="token punctuation">:</span> resource does not exist <span class="token keyword">if</span> <span class="token keyword">private</span><span class="token punctuation">)</span>\n                      <span class="token punctuation">(</span><span class="token keyword">or</span> <span class="token number">3</span>xx<span class="token punctuation">:</span> redirection<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>:::note 通常按以下顺序进行检查</p><ul><li>404（如果资源是公共资源且不存在）或3xx重定向</li></ul><p>除此以外：</p><ul><li>401（如果未登录或会话已过期）</li><li>403 如果用户无权访问资源（文件，json，...）</li><li>404（如果资源不存在或不愿意透露任何内容），或3xx重定向 :::</li></ul><h3 id="认证-authentication" tabindex="-1"><a class="header-anchor" href="#认证-authentication" aria-hidden="true">#</a> 认证 Authentication</h3><p>:::note 语义 指证明身份正确 :::</p><p>:::note HTTP 状态码 <code>401 Unauthorized</code>，该HTTP状态码表示认证错误，表示这个请求没有被服务器认证或者客户端传送的证书错误，可以修改后在进行重试。 :::</p>',12),e=(0,p.Uk)(":::note 引用场景 "),t={href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"},r=(0,p.Uk)("JWT(JSON Web Tokens)"),c=(0,p.Uk)("根据用户名和密码获取令牌。如果用户名或者密码错误则直接返回："),l=(0,p._)("code",null,"401 Unauthorized",-1),k=(0,p.Uk)(" :::"),i=(0,p.uE)('<p>401的正确解释应该是<code>&quot;Unauthenticated&quot;,</code> 而且在<code>HTTP Authentication: Basic and Digest Access Authentication</code>中需要带的请求头也应该是<code>Authentication</code>而不是<code>Authorization</code></p><p>这个是历史遗留问题了, 估计以后也不会有什么改变, 但我们还是需要知道这个问题, 免得在使用时混淆了401和403。</p><h3 id="授权-authorization" tabindex="-1"><a class="header-anchor" href="#授权-authorization" aria-hidden="true">#</a> 授权 Authorization</h3><p>:::note 语义 指允许某种行为 :::</p><p>:::note HTTP 状态码 403 Forbidden ，该HTTP状态码关于授权的，跟应用的的逻辑有关，表示客户端没有权限去访问要求资源。403表示用户认证后，但权限不足，无法对该资源进行操作。 :::</p>',5),u=(0,p.Uk)(":::note 引用场景 "),d={href:"https://casbin.org/zh-CN/",target:"_blank",rel:"noopener noreferrer"},b=(0,p.Uk)("Casbin 权限系统"),h=(0,p.Uk)("。根据策略和请求中出现的用户、角色是否允许访问资源。如果不允许访问资源则直接返回："),m=(0,p._)("code",null,"403 Forbidden",-1),v=(0,p.Uk)(" :::"),f={},T=(0,n(3744).Z)(f,[["render",function(s,a){const n=(0,p.up)("OutboundLink");return(0,p.wg)(),(0,p.iD)(p.HY,null,[o,(0,p._)("p",null,[e,(0,p._)("a",t,[r,(0,p.Wm)(n)]),c,l,k]),i,(0,p._)("p",null,[u,(0,p._)("a",d,[b,(0,p.Wm)(n)]),h,m,v])],64)}]])},3744:(s,a)=>{a.Z=(s,a)=>{const n=s.__vccOpts||s;for(const[s,p]of a)n[s]=p;return n}}}]);